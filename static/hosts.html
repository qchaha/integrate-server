<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>devops rookie</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
  <!-- vuetable2 -->
  <link rel="stylesheet" href="dist/css/vuetable-2.css">



  <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
  page. However, you can choose any other skin. Make sure you
  apply the skin class to the body tag so the changes take effect. -->
  <link rel="stylesheet" href="dist/css/skins/skin-purple.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet" href="dist/css/google-font.css">

  <!-- for flots label-->
  <style>
    .legendLabel {
      padding-right: 20px;
    }

    .fade-enter-active {
      transition: opacity 0.5s;
      opacity: 0;
    }

    .fade-leave-active {
      transition: opacity 1s;
      opacity: 0;
    }
    .table-height {
      height: 480px;
    }
    /*hover table color*/
    .table-hover tbody tr:hover td, .table-hover tbody tr:hover th {
      background-color: #f0f7ff;
      cursor: pointer;
    }
    .table-selected{
      background-color: #f0f7ff;
    }

    .datatable-icon{
      font-size: 18px;
    }
  </style>

  <style>
    [v-cloak] {
      display: none;
    }
  </style>


</head>

<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->

<body class="hold-transition skin-purple sidebar-mini">


  <div class="wrapper">
    <!----------------------
    Main Header
    ------------------------>
    <script src="dist/module-js/main-header.js"></script>

    <!------------------------------------------
    Left side column. contains the logo and sidebar
    -------------------------------------------->
    <script src="dist/module-js/main-sidebar.js"></script>

    <!------------------------------------------
    Content Wrapper. Contains page content
    -------------------------------------------->

    <div class="content-wrapper" id="vueapp" v-cloak>
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <h1>主机
          <small>Hosts</small>
        </h1>
      </section>
      <!--/. content-header-->

      <section class="content container-fluid">
        <!--hosts list-->
        <div class="col-md-5">
          <div class="box box-info" style="height:659px">
            <div class="box-header with-border">
              <h3 class="box-title">主机列表</h3>
            </div>
            <div class="mailbox-controls">
              <div class="btn-group" style="margin: -20px 10px -90px 5px">
                <button type="button" class="btn btn-default bg-purple" data-toggle="modal" data-target="#modal-addhost"><i class="fa fa-plus"></i> 添加</button>
              </div>
              <div class="btn-group" style="margin: -20px 10px -90px 10px">
                <button type="button" class="btn btn-default bg-red" data-toggle="modal" data-target="#modal-deletehost" v-if="delok"><i class="fa fa-minus"></i> 删除</button>
                <button type="button" class="btn btn-default bg-red disabled" v-if="!delok"><i class="fa fa-minus"></i> 删除</button>
              </div>
              <div class="btn-group" style="margin: -20px 10px -90px 10px">
                <button type="button" class="btn btn-default bg-gary" v-on:click="open_multiselect()"><i class="fa fa-tasks"></i> {{ ismulti }}</button>
                <button type="button" class="btn btn-default dropdown-toggle bg-gary" data-toggle="dropdown" aria-expanded="false" v-if="checkbox_show">
                  <span class="caret"></span>
                  <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu" role="menu">
                  <li><a href="#">全选</a></li>
                  <li class="divider"></li>
                  <li><a href="#">取消选择</a></li>
                </ul>
              </div>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <div class="table-responsive mailbox-messages">
                <table class="table table-hover" id="vuetable" v-if="!isinit">
                  <thead>
                      <tr>
                        <th style="width: 30px">序号</th>
                        <th style="width: 90px">IP地址</th>
                        <th style="width: 50px">主机名</th>
                        <th>状态</th>
                        <th style="width: 30px">OS</th>
                        <th>更多操作</th>
                      </tr>
                  </thead>
                  <tbody style="font-weight:normal">
                    <tr v-for="(host, index) in host_info" v-bind:class="selected_class[index + 1]" style="height:44px" v-on:click="row_selected(host.hostname, host.ip_address, index + 1)">
                      <td>
                        <input type="checkbox" v-bind:id="index + 1" v-model="selected_rows" v-bind:value="index + 1" v-if="checkbox_show"></input>
                        <label v-bind:for="index" v-if="!checkbox_show">{{ index + 1 + '.' }}</label>
                      </td>
                      <td><a href="#">{{ host.ip_address }}</a></td>
                      <td><a href="#">{{ host.hostname }}</a></td>
                      <td>
                        <span class="badge bg-green" style="width: 40px" v-if="online[index + 1]">在线</span>
                        <span class="badge bg-red" style="width: 40px" v-if="offline[index + 1]">离线</span>
                        <i class="fa fa-spinner fa-spin" v-if="loading[index + 1]"></i>
                      </td>
                      <td><i class="fa fa-windows datatable-icon" v-if="host.os_type == 'Windows'"></i><i class="fa fa-linux datatable-icon" v-if="host.os_type == 'Linux'"></i></td>
                      <td><i style="padding: 0 15px 0 5px" class="fa fa-folder-open datatable-icon"></i><i class="fa fa-terminal datatable-icon" v-on:click="open_multiselect()"></i></td>
                   </tr>
                  </tbody>
                </table>
                <!-- /.table -->
              </div>
              <!-- /.mail-box-messages -->
            </div>
            <!-- /.box-body -->
          </div>
        </div>
        <!--./hosts list-->



        <div class="col-md-7">
          <!-- Widget: user widget style 1 -->
          <div class="box box-widget widget-user-2">
            <!-- Add the bg color to the header using any of the bg-* classes -->
            <div class="widget-user-header bg-blue" v-cloak>
              <span class="info-box-icon bg-blue"><i class="fa fa-desktop"></i></span>
              <h2 class="widget-user-desc" style="padding: 0 0 0 40px">IP地址：{{ selected_ip }}</h3>
                <h3 class="widget-user-username" style="padding: 0 0 0 40px">主机名：{{ selected_hostname }}</h5>
                </div>
                <div class="box-footer no-padding" >
                  <ul class="nav nav-stacked" v-bind:style="{display: show}" >
                    <div class="overlay fade-enter-active fade-leave-active" v-bind:style="{opacity: loading_status}">
                      <!-- Custom Tabs -->
                      <li>
                        <div class="nav-tabs-custom tab-warning">
                          <ul class="nav nav-tabs">
                            <li class="active"><a href="#tab_cpu" data-toggle="tab" aria-expanded="true">CPU实时状态</a></li>
                            <li class=""><a href="#tab_mem" data-toggle="tab" aria-expanded="false">内存实时状态</a></li>
                            <li><a href="#tab_net" data-toggle="tab">网络实时流量</a></li>
                          </ul>
                          <div class="tab-content">
                            <div class="tab-pane active" id="tab_cpu">
                              <!--cpu usage charts-->
                              <div>
                                <!-- interactive chart -->
                                <div class="box-header with-border">
                                  <i class="fa fa-bar-chart-o"></i>
                                  <h3 class="box-title">CPU实时状态</h3><p></p>
                                  <div class="box-tools pull-right">实时
                                    <div class="btn-group" id="realtime" data-toggle="btn-toggle">
                                      <button type="button" class="btn btn-default btn-xs active" data-toggle="on">On</button>
                                      <button type="button" class="btn btn-default btn-xs" data-toggle="off">Off</button>
                                    </div>
                                  </div>
                                </div>
                                <div class="box-body">
                                  <div id="interactive-cpu" style="margin: -38px 0 -30px -30px;"></div>
                                </div>
                                <!-- /.box-body-->
                              </div>
                              <!--/.cpu usage charts-->

                            </div>
                            <!-- /.tab-pane -->
                            <div class="tab-pane" id="tab_mem">
                              <!--memory usage charts-->
                              <div>
                                <!-- interactive chart -->
                                <div class="box-header with-border">
                                  <i class="fa fa-bar-chart-o"></i>
                                  <h3 class="box-title">内存实时状态</h3><p></p>
                                  <div class="box-tools pull-right">实时
                                    <div class="btn-group" id="realtime" data-toggle="btn-toggle">
                                      <button type="button" class="btn btn-default btn-xs active" data-toggle="on">On</button>
                                      <button type="button" class="btn btn-default btn-xs" data-toggle="off">Off</button>
                                    </div>
                                  </div>
                                </div>
                                <div class="box-body">
                                  <div id="interactive-memory" style="margin: -38px 0 -30px -30px;;"></div>
                                </div>
                                <!-- /.box-body-->
                              </div>
                              <!--/.memory usage charts-->
                            </div>
                            <!-- /.tab-pane -->
                            <div class="tab-pane" id="tab_net">
                              <!--network usage charts-->
                              <div>
                                <!-- interactive chart -->
                                <div class="box-header with-border">
                                  <i class="fa fa-bar-chart-o"></i>
                                  <h3 class="box-title">网络实时流量</h3><p></p>
                                  <div class="box-tools pull-right">实时
                                    <div class="btn-group" id="realtime" data-toggle="btn-toggle">
                                      <button type="button" class="btn btn-default btn-xs active" data-toggle="on">On</button>
                                      <button type="button" class="btn btn-default btn-xs" data-toggle="off">Off</button>
                                    </div>
                                  </div>
                                </div>
                                <div class="box-body">
                                  <div id="interactive-network" style="margin: -38px 0 -30px -30px;"></div>
                                </div>
                                <!-- /.box-body-->
                              </div>
                              <!--/.network usage charts-->
                            </div>
                            <!-- /.tab-content -->
                          </div>
                        </li>
                        <!-- nav-tabs-custom -->
                      </div>
                    </ul>
                    <div class="col-md-15 fade-enter-active fade-leave-active" style="display:none; height: 540px;" v-bind:style="{opacity: loading_status, display: code404}">
                      <div class="error-page col-md-7" style="padding: 120px 0 0 80px">
                        <i class=" headline fa fa-warning text-yellow" style="padding: 0 30px 0 0"></i>
                        <h2 class="headline text-yellow" style="margin: 0 0 0 0; ">code: 404 </h2>
                      </div>
                      <!-- /.error-page -->
                      <div class="col-md-12" style="padding: 30px 0 0 60px; border-style: none;">
                        <div>
                          <div class="box-header">
                            <i class="fa fa-exclamation-circle text-yellow"></i>
                            <h3 class="box-title">警告：</h3>
                          </div>
                          <!-- /.box-header -->
                          <div class="box-body">
                            <blockquote>
                              <p style="font-size:24px">获取主机实时信息失败，请尝试检查以下项目：</p>
                              <small style="font-size:18px;padding: 0 0 10px 0">1. 当前主机可能处于离线状态，请检查主机网络连通性。</small>
                              <small style="font-size:18px;padding: 0 0 10px 0">2. 当前主机代理无法收集实时数据，请检查主机代理状态。</small>
                            </blockquote>
                          </div>
                          <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                      </div>
                    </div>
                    <div class="overlay"><i class="fa fa-refresh fa-spin" style="opacity: 0.8;font-size: 96px" v-bind:style="{display: loading_page}"></i></div>
                  </div>
                </div>
                <!-- /.widget-user -->
              </div>

      </section>
      <!--./content container-fluid-->
  </div>
  <!--./wrapper-->


  <!--删除主机弹出的确认对话框-->
  <div class="modal fade" id="modal-deletehost">
    <div class="modal-dialog" style="width: 400px">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title"><i class=" headline fa fa-warning text-red" style="padding: 0 10px 0 0 "></i>注意</h4>
          </div>
          <div class="modal-body">
            <p style="font-size:120%">被选中的主机将从"主机列表"中删除！</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default pull-left" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-danger" onclick="v_vue.delete_host()" data-dismiss="modal">确定</button>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

    <!-- 添加主机弹出的对话框 -->
    <div class="modal fade" id="modal-addhost">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title"><i class=" headline fa fa-plus text-black" style="padding: 0 10px 0 0 "></i>添加主机</h4>
            </div>
            <div class="modal-body">
                <div class="box-header with-border">
                  <h3 class="box-title">填写主机信息</h3>
                </div>
                <!-- /.box-header -->
                <!-- form start -->
                <form class="form-horizontal">
                  <div class="box-body">
                    <div class="form-group">
                      <label class="col-sm-5 control-label">主机IP地址：</label>
                      <div class="input-group col-sm-4">
                        <div class="input-group-addon"><i class="fa fa-laptop" style="width: 12px"></i></div>
                        <input v-model="add_host_ip" class="form-control">
                      </div>
                      <!-- /.input group -->
                    </div>
                    <div class="form-group">
                      <label class="col-sm-5 control-label">系统管理员用户：</label>
                      <div class="input-group col-sm-4">
                        <div class="input-group-addon"><i class="fa fa-user" style="width: 12px"></i></div>
                        <input type="text" class="form-control" v-model="add_host_admin_user">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-5 control-label">系统管理员密码：</label>
                      <div class="input-group col-sm-4">
                        <div class="input-group-addon"><i class="fa fa-lock" style="width: 12px"></i></div>
                        <input type="password" class="form-control" v-model="add_host_admin_password">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-5 control-label">操作系统：</label>
                      <div class="input-group col-sm-4">
                        <div class="input-group-addon"><i class="fa fa-windows" style="width: 12px"></i></div>
                        <select class="form-control" v-model="add_host_os">
                          <option></option>
                          <option value="Redhat 6.5">Redhat 6.5</option>
                          <option value="Redhat 5.8">Redhat 5.8</option>
                          <option value="Win2008 R2 x64">Win2008 R2 x64</option>
                          <option value="Win2008 R2 x86">Win2008 R2 x86</option>
                          <option value="Win2003 x64">Win2003 x64</option>
                          <option value="Win2003 x86">Win2003 x86</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <!-- /.box-body -->
                </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default pull-left" data-dismiss="modal">取消</button>
              <button type="button" class="btn btn-primary disabled" v-if="!(add_host_ip.length > 0 && add_host_admin_user.length > 0 && add_host_admin_password.length > 0 && add_host_os.length > 0)">确定</button>
              <button type="button" class="btn btn-primary" v-on:click="add_host()" data-dismiss="modal" v-if="(add_host_ip.length > 0 && add_host_admin_user.length > 0 && add_host_admin_password.length > 0 && add_host_os.length > 0)">确定</button>
            </div>
        </div>
      </div>
    </div>


  <!----------------------
          Main Footer
          ------------------------>
  <script src="dist/js/vue.js"></script>
  <script src="dist/module-js/main-footer.js"></script>
  </div>
  <!--./wrapper-->

  <!-- Page script -->

  <!--axios v0.17.1-->
  <script src="dist/js/axios.js"></script>
  <!--echarts v3.2.8-->
  <script src="dist/js/echarts.js"></script>
  <!--theme for echarts-->
  <script src="dist/js/themes/shine.js"></script>
  <!--theme for echarts-->
  <script src="dist/js/themes/macarons.js"></script>
  <!-- jQuery 3 -->
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <!-- Bootstrap 3.3.7 -->
  <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <!-- DataTables -->
  <script src="bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
  <!-- DataTables -->
  <script src="bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
  <!-- vuetable2 -->
  <script src="dist/js/vuetable-2-full.js"></script>
  <!-- ip input mask-->
  <script src="dist/js/vue-the-mask.js"></script>
  <!-- AdminLTE App slide navigator-->
  <script src="dist/js/adminlte.min.js"></script>


  <script>
    /****************************************************************************

    *****************************************************************************/

    var global_settimeout_id = 0;
    var global_loading_ticks = 0;

    //添加主机对话框vue
    var v_vue_modal_addhost = new Vue({
      el: '#modal-addhost',
      data: {
        add_host_ip: '',             //添加主机的ip地址
        add_host_admin_user: '',     //添加主机的管理员用户
        add_host_admin_password: '', //添加主机的管理员密码
        add_host_os: '',             //添加主机的操作系统
      },
      methods: {
          add_host: function(){
            var self = this;
            axios.post('/api/add_hosts_v1.0', {
              add_host_ip: self.add_host_ip,
              add_host_admin_user: self.add_host_admin_user,
              add_host_admin_password: self.add_host_admin_password,
              add_host_os: self.add_host_os
            })
            .then(function(response){
                if(response.data.op_result == "add sucessful!")
                {
                  window.location.reload();
                }
            })
            .catch(function(error){
              console.log(error);
            });
        }
      }
    });

    //页面vue
    var v_vue = new Vue({
      el: '#vueapp',
      data: {
        host_info: '',               //被选中显示实时状态的主机信息
        selected_hostname: '',       //显示到右方表头的主机名
        selected_ip: '',             //显示到右方表头的主机IP
        host_alive_info: [],         //保存列表中的主机是否在线的数组
        online: [],                  //与host_alive_info对应，控制表格样式，true显示“在线”
        offline: [],                 //与host_alive_info对应，控制表格样式，true显示“离线”
        loading: [],                 //与host_alive_info对应，控制表格样式，true显示“loading动画”
        loading_status: 0.2,         //echarts在loading时，进行模糊处理
        loading_page: '',            //''为显示在echarts上的loading页面
        show: '',                    //''为显示echarts
        code404: 'none',             //''为显示echarts上的404错误页面，默认'none'不显示
        selected_class: [],          //记录table被选中状态
        selected_rows: [],           //记录checkbox被选中的行，传到后台
        checkbox_show: false,        //不点多选按钮前，不显示多选按钮，点击作为切换
        single_select_content: 0,    //记录点击多选前的状态，当返回单选状态时，切换回之前单选的状态
        ismulti: '多选',             //多选和单选按钮的标题
        isinit:  true,               //是否第一次运行，控制jquery table只在第一次运行时创建，其他刷新状态不再创建
        delok: false,                //控制开关，控制是否能点击删除
        add_host_ip: '',
        /********************
        for echarts
        ********************/
        hostname: [],
        date: [],
        ip: [],
        cpu_usr: [],
        cpu_sys: [],
        cpu_idle: [],
        cpu_wait: [],
        mem_used: [],
        mem_buffer: [],
        mem_cache: [],
        mem_free: [],
        disk_read: [],
        disk_write: [],
        net_recv: [],
        net_send: [],
      },
      mounted: function() {
        var self = this;
        self.find_all_host();
      },
      methods: {
        find_all_host: function(){
          var self = this;
          //从mysql中获取所有主机信息
          axios.get('/api/find_all_host_v1.0')
            .then(function(response) {
              //重置状态
              self.delok = false;
              self.checkbox_show = false;
              self.single_select_content = 0;
              self.selected_class = [];
              Vue.set(self.selected_class, 1, 'table-selected');
              self.selected_rows = [];
              self.selected_rows[0] = 1;
              self.host_info = [];
              for( var i = 0; i < response.data.host_info.length; i++ )
              {
                Vue.set(self.host_info, i, response.data.host_info[i]);
              }
              self.selected_hostname = self.host_info[0].hostname;
              self.selected_ip = self.host_info[0].ip_address;

              for (var i = 1; i <= self.host_info.length; i++) {
                self.loading[i] = true;
              }
              self.check_host_alive();
              update();
              $(function() {
                $('#vuetable').DataTable({
                  "dom": "<'row'<'col-sm-6'><'col-sm-6'<'datatable-search-position'f>>>" +
                  "<'row'<'col-sm-12'<'table-height'tr>>>" +
                  "<'row'<'col-sm-5'i><'col-sm-7'p>>",
                  "destroy": true,
                  "pageLength": 9,
                  "columns": [
                    null,
                    null,
                    null,
                    null,
                    { "orderable": false },
                    { "orderable": false },
                  ]
                })
              });
              self.isinit = false;
            })
            .catch(function(error) {
              console.log(error)
            });
        },
        show_echarts: function(hostname, ip) {
          var self = this;
          self.selected_hostname = hostname;
          self.selected_ip = ip;
          global_loading_ticks = 0;
          realtime = 'on';
          update();
          self.loading_complete();
        },
        check_host_alive: function() {
          //得到所有主机信息后，检查所有主机的是否在线的状态
          var self = this;
          for (var i = 1; i <= self.host_alive_info.length; i++) {
            Vue.set(self.online, i, false);
            Vue.set(self.offline, i, false);
            Vue.set(self.loading, i, true);
          }
          axios.get('/api/check_host_alive_v1.0')
            .then(function(response) {
              self.host_alive_info = response.data.host_alive_info;
              for (var i = 0; i < self.host_alive_info.length; i++) {
                if (self.host_alive_info[i] == "online") {
                  Vue.set(self.online, i + 1, true);
                  Vue.set(self.offline, i + 1, false);
                  Vue.set(self.loading, i + 1, false);
                } else {
                  Vue.set(self.online, i + 1, false);
                  Vue.set(self.offline, i + 1, true);
                  Vue.set(self.loading, i + 1, false);
                }
              }
              //当查询状态是否在线后，需要删除原先的表格，重新进行创建
              $(function() {
                $('#vuetable').DataTable({
                  "dom": "<'row'<'col-sm-6'><'col-sm-6'<'datatable-search-position'f>>>" +
                  "<'row'<'col-sm-12'<'table-height'tr>>>" +
                  "<'row'<'col-sm-5'i><'col-sm-7'p>>",
                  "destroy": true,
                  "pageLength": 9,
                  "columns": [
                    null,
                    null,
                    null,
                    null,
                    { "orderable": false },
                    { "orderable": false },
                  ]
                });
              });
              self.delok = true;
            })
            .catch(function(error) {
              console.log(error)
            });
        },
        loading_complete: function() {
          var self = this;
          if (global_loading_ticks > 1) {
            self.loading_status = 1;
            self.loading_page = 'none';
          } else {
            self.loading_status = 0.2;
            self.loading_page = '';
          }
        },
        refresh: function() {
          /****************************************************************************
          //V1.1
          //取数是在数据库中读出，是1分钟内连续的点，用此方法时，echarts马上显示全部描绘的点，
          //效果比较好看，还需要配搭loading效果过渡，这样完美
          ****************************************************************************/
          var self = this;
          axios.get('/kafka/get_host_info_v1.1/' + self.selected_hostname)
            .then(function(response) {
              //console.log(response.data.host_data)
              self.code404 = 'none';
              self.show = '';
              for (var i = 0; i < response.data.host_data.length; i++) {
                self.date[i] = response.data.host_data[i].date;
                self.hostname[i] = response.data.host_data[i].hostname;
                self.ip[i] = response.data.host_data[i].ip_address;
                self.cpu_usr[i] = response.data.host_data[i].cpu_usr;
                self.cpu_sys[i] = response.data.host_data[i].cpu_sys;
                self.cpu_idle[i] = response.data.host_data[i].cpu_idle;
                self.cpu_wait[i] = response.data.host_data[i].cpu_wait;
                self.mem_used[i] = response.data.host_data[i].mem_used;
                self.mem_buffer[i] = response.data.host_data[i].mem_buffer;
                self.mem_cache[i] = response.data.host_data[i].mem_cache;
                self.mem_free[i] = response.data.host_data[i].mem_free;
                self.disk_read[i] = response.data.host_data[i].disk_read;
                self.disk_write[i] = response.data.host_data[i].disk_write;
                self.net_recv[i] = response.data.host_data[i].net_recv;
                self.net_send[i] = response.data.host_data[i].net_send;
              }
            })
            .catch(function(error) {
              console.log(error)
              if (error.response.status == 404) {
                self.code404 = '';
                self.show = 'none';
                global_loading_ticks = 3;
              }
            });
        },
        //用于显示被选中的样式，用数组来记录每行表格每个值的数据
        row_selected: function(hostname, ip, id){
          var self = this;
          if( self.checkbox_show == false )
          {
            for(var i = 1; i < self.host_info.length + 1; i++)
            {
              if( i == id )
              {
                Vue.set(self.selected_class, i, 'table-selected');
                self.selected_rows = [];
                self.selected_rows.push(i);
              }
              else
              {
                Vue.set(self.selected_class, i, '');
              }
            }
            self.show_echarts(hostname, ip);
          }
          else if( self.checkbox_show == true )
          {
            for( var i = 1; i < self.host_info.length + 1; i++ )
            {
              if( i == id )
              {
                if( self.selected_class[i] == 'table-selected' )
                {
                  Vue.set( self.selected_class, i ,'' );
                  for(var j = 0; j < self.selected_rows.length; j++)
                  {
                    if( self.selected_rows[j] == id )
                    {
                      self.selected_rows.splice(j , 1);
                    }
                  }
                }
                else
                {
                  Vue.set( self.selected_class, i ,'table-selected' );
                  self.selected_rows.push(i);
                }
              }
            }
          }
        },
        open_multiselect: function(){
          var self = this;
          //table是单选切换多选时，切换开关，然后记录单选时选中哪项，用于在多选返回单选时还原状态
          if( self.checkbox_show == false )
          {
            self.ismulti = '单选';
            self.checkbox_show = !self.checkbox_show;
            for( var i = 1; i < self.host_info.length + 1; i++ )
            {
              if( self.selected_class[i] == 'table-selected' )
              {
                single_select_content = i;
              }
            }
            self.selected_rows = [];
            self.selected_rows[0] = single_select_content;
            Vue.set(self.selected_class, single_select_content, 'table-selected');
          }
          //table是多选切换单选时，切换开关，然后切换至原单选上下文
          else
          {
            self.ismulti = '多选';
            self.checkbox_show = !self.checkbox_show;
            self.selected_class = [];
            Vue.set(self.selected_class, single_select_content, 'table-selected');
            self.selected_rows[0] = single_select_content;
          }
        },
        delete_host: function(){
          var self = this;
          var selected_ips = [];
          for( var i = 0; i < self.host_info.length + 1; i++ )
          {
            for( var j = 0; j < self.selected_rows.length; j++ )
            {
              if( self.selected_rows[j] == i )
                //console.log(self.host_info[self.selected_rows[j] - 1].ip)
                selected_ips.push(self.host_info[self.selected_rows[j] - 1].ip_address);
            }
          }
          axios.post('/api/delete_hosts_v1.0', {selected_ips: selected_ips})
          .then(function(response){
              if(response.data.op_result == "delete sucessful!")
              {
                window.location.reload();
              }
          })
          .catch(function(error){
            console.log(error);
          });
        }
      }
    });


    function convert_kb(traffic) {
      var re = "";
      if ((traffic).substring((traffic).length - 1, (traffic).length) === "k") {
        re = parseInt((traffic).substring(0, (traffic).length - 1));
      } else if ((traffic).substring((traffic).length - 1, (traffic).length) === "B") {
        re = parseInt(parseInt((traffic).substring(0, (traffic).length - 1)) / 1024);
      } else if ((traffic).substring((traffic).length - 1, (traffic).length) === "M") {
        re = parseInt((traffic).substring(0, (traffic).length - 1)) * 1024;
      }
      return re;
    }

    function getTotalMemory(v_vue) {
      var re = 0;
      var max = 0;
      var max_temp = 0;
      for (var i = 0; i < v_vue.date.length; i++) {
        max_temp = parseInt((v_vue.mem_used[i]).substring(0, (v_vue.mem_used[i]).length - 1)) +
          parseInt((v_vue.mem_buffer[i]).substring(0, (v_vue.mem_buffer[i]).length - 1)) +
          parseInt((v_vue.mem_cache[i]).substring(0, (v_vue.mem_cache[i]).length - 1)) +
          parseInt((v_vue.mem_free[i]).substring(0, (v_vue.mem_free[i]).length - 1));
        if (max_temp > max) {
          max = max_temp;
        } else {
          max = max;
        }
      }

      var digits = (max.toString()).length;
      var lead = parseInt((max.toString()).substring(0, 1)) + 1;
      re = lead.toString();
      for (var i = 1; i < digits; i++) {
        re = re + "0";
      }
      return re;
    }

    function getTopNetworkIO(data_send, data_recv) {
      var re = "";
      var max = 0;
      var max_send = 0;
      var max_recv = 0;

      for (var i = 0; i < data_send.length; i++) {
        if (max_send <= data_send[i]) {
          max_send = data_send[i];
        } else {
          max_send = max_send;
        }
      }

      for (var i = 0; i < data_recv.length; i++) {
        if (max_recv <= data_recv[i]) {
          max_recv = data_recv[i];
        } else {
          max_recv = max_recv;
        }
      }

      if (max_send >= max_recv) {
        max = max_send;
      } else {
        max = max_recv;
      }

      var digits = (max.toString()).length;
      var lead = parseInt((max.toString()).substring(0, 1)) + 1;
      re = lead.toString();
      for (var i = 1; i < digits; i++) {
        re = re + "0";
      }
      //console.log(re)
      return re;
    }


    var dom_cpu = document.getElementById("interactive-cpu");
    var dom_mem = document.getElementById("interactive-memory");
    var dom_net = document.getElementById("interactive-network");

    var resizeMainContainer = function() {
      dom_cpu.style.width = window.innerWidth * 0.5 + 'px';
      dom_cpu.style.height = '455px';
      //dom_cpu.style.height = '370px';
      dom_mem.style.width = window.innerWidth * 0.5 + 'px';
      dom_mem.style.height = '455px';
      //dom_mem.style.height = '370px';
      dom_net.style.width = window.innerWidth * 0.5 + 'px';
      dom_net.style.height = '455px';
      //dom_net.style.height = '370px';
    };
    //设置div容器高宽
    resizeMainContainer();

    var chart_cpu = echarts.init(dom_cpu, "shine");
    var chart_mem = echarts.init(dom_mem, "shine");
    var chart_net = echarts.init(dom_net, "shine");

    // 初始化图表
    $(window).on('resize', function() { //
      //屏幕大小自适应，重置容器高宽
      resizeMainContainer();
      chart_cpu.resize();
      chart_mem.resize();
      chart_net.resize();
    });

    option_cpu = null;
    option_mem = null;
    option_net = null;

    option_cpu = {
      title: {
        text: '',
        subtext: ''
      },
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'cross',
          label: {
            backgroundColor: '#283b56'
          }
        }
      },
      legend: {
        data: ['cpu_usr', 'cpu_sys', 'cpu_wait'],
        itemGap: 50
      },
      dataZoom: {
        show: false,
        start: 0,
        end: 100
      },
      xAxis: [{
        type: 'category',
        splitLine: {
          show: false
        },
        data: []
      }],
      yAxis: [{
        type: 'value',
        scale: true,
        name: '',
        max: 100,
        min: 0,
        axisLabel: {
          formatter: '{value} %'
        }
        //boundaryGap: [0.4, 0.4]
      }],
      series: [{
          name: 'cpu_usr',
          type: 'line',
          //areaStyle: {normal: {}},
          data: []
        },
        {
          name: 'cpu_sys',
          type: 'line',
          //areaStyle: {normal:{}},
          data: []

        },
        {
          name: 'cpu_wait',
          type: 'line',
          //areaStyle: {normal: {}},
          data: []
        }
      ]
    };
    option_mem = {
      title: {
        text: '',
        subtext: ''
      },
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'cross',
          label: {
            backgroundColor: '#283b56'
          }
        }
      },
      legend: {
        data: ['mem_used', 'mem_buffer', 'mem_cache'],
        itemGap: 50
      },
      dataZoom: {
        show: false,
        start: 0,
        end: 100
      },
      xAxis: [{
        type: 'category',
        splitLine: {
          show: false
        },
        data: []
      }],
      yAxis: [{
        type: 'value',
        scale: true,
        name: '',
        max: 100,
        min: 0,
        axisLabel: {}
        //boundaryGap: [0.4, 0.4]
      }],
      series: [{
          name: 'mem_used',
          type: 'line',
          data: []
        },
        {
          name: 'mem_buffer',
          type: 'line',
          data: []
        },
        {
          name: 'mem_cache',
          type: 'line',
          data: []
        }
      ]
    };
    option_net = {
      title: {
        text: '',
        subtext: ''
      },
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'cross',
          label: {
            backgroundColor: '#283b56'
          }
        }
      },
      legend: {
        data: ['net_send', 'net_recv'],
        itemGap: 50
      },
      dataZoom: {
        show: false,
        start: 0,
        end: 100
      },
      xAxis: [{
        type: 'category',
        splitLine: {
          show: false
        },
        data: []
      }],
      yAxis: [{
        type: 'value',
        scale: true,
        name: '',
        max: 7000,
        min: 0,
        axisLabel: {}
        //boundaryGap: [0.4, 0.4]
      }],
      series: [{
          name: 'net_send',
          type: 'line',
          data: []
        },
        {
          name: 'net_recv',
          type: 'line',
          data: []
        }
      ]
    };

    if (option_cpu && typeof option_cpu === "object") {
      chart_cpu.setOption(option_cpu, true);
    }
    if (option_mem && typeof option_mem === "object") {
      chart_mem.setOption(option_mem, true);
    }
    if (option_net && typeof option_net === "object") {
      chart_net.setOption(option_net, true);
    }

    function draw_cpu() {
      //axisData = (new Date()).toLocaleTimeString().replace(/^\D*/,'');

      var data0 = option_cpu.series[0].data;
      var data1 = option_cpu.series[1].data;
      var data2 = option_cpu.series[2].data;
      var time = "";
      var old_time = "";

      for (var i = 0; i < v_vue.date.length; i++) {
        //option.xAxis[0].data.shift();
        //option.xAxis[0].data.push(axisData);
        time = v_vue.date[i];
        if (i != 0) {
          old_time = v_vue.date[i - 1];

          if (old_time > time) {
            console.log("cpu axis value error, time be passed!");
            continue;
          }
        }

        if (time != "") {
          var hours = (new Date(time)).getHours() < 10 ? "0" + (new Date(time)).getHours() : (new Date(time)).getHours();
          var minutes = (new Date(time)).getMinutes() < 10 ? "0" + (new Date(time)).getMinutes() : (new Date(time)).getMinutes();
          var seconds = (new Date(time)).getSeconds() < 10 ? "0" + (new Date(time)).getSeconds() : (new Date(time)).getSeconds();

          if (option_cpu.xAxis[0].data.length > 20)
            option_cpu.xAxis[0].data.shift();
          option_cpu.xAxis[0].data.push(hours + ":" + minutes + ":" + seconds);
        }


        if (data0.length > 20)
          data0.shift();
        data0.push(v_vue.cpu_usr[i]);
        if (data1.length > 20)
          data1.shift();
        data1.push(v_vue.cpu_sys[i]);
        if (data2.length > 20)
          data2.shift();
        data2.push(v_vue.cpu_wait[i]);
      }
      chart_cpu.setOption(option_cpu);
    }
    function draw_mem() {
      //axisData = (new Date()).toLocaleTimeString().replace(/^\D*/,'');
      var data0 = option_mem.series[0].data;
      var data1 = option_mem.series[1].data;
      var data2 = option_mem.series[2].data;


      var time = "";
      var old_time = "";


      //yaxis data
      for (var i = 0; i < v_vue.date.length; i++) {
        //xaxis time data
        time = v_vue.date[i];
        if (i != 0) {
          old_time = v_vue.date[i - 1];
          if (old_time > time) {
            console.log("mem axis value error, time be passed!");
            continue;
          }
        }
        if (time != "") {
          var hours = (new Date(time)).getHours() < 10 ? "0" + (new Date(time)).getHours() : (new Date(time)).getHours();
          var minutes = (new Date(time)).getMinutes() < 10 ? "0" + (new Date(time)).getMinutes() : (new Date(time)).getMinutes();
          var seconds = (new Date(time)).getSeconds() < 10 ? "0" + (new Date(time)).getSeconds() : (new Date(time)).getSeconds();

          if (option_mem.xAxis[0].data.length > 20)
            option_mem.xAxis[0].data.shift();
          option_mem.xAxis[0].data.push(hours + ":" + minutes + ":" + seconds);
        }

        if (data0.length > 20)
          data0.shift();
        data0.push((v_vue.mem_used[i]).substring(0, (v_vue.mem_used[i]).length - 1));
        if (data1.length > 20)
          data1.shift();
        data1.push((v_vue.mem_buffer[i]).substring(0, (v_vue.mem_buffer[i]).length - 1));
        if (data2.length > 20)
          data2.shift();
        data2.push((v_vue.mem_cache[i]).substring(0, (v_vue.mem_cache[i]).length - 1));
        //option.xAxis[0].data.shift();
        //option.xAxis[0].data.push(axisData);

        //set yaxis scale value
        option_mem.yAxis[0].max = getTotalMemory(v_vue);
        option_mem.yAxis[0].axisLabel.formatter = "{value} " + (v_vue.mem_used[i]).substring((v_vue.mem_used[i]).length - 1, (v_vue.mem_used[i]).length);
      }

      chart_mem.setOption(option_mem);

    }
    function draw_net() {
      //axisData = (new Date()).toLocaleTimeString().replace(/^\D*/,'');

      var data0 = option_net.series[0].data;
      var data1 = option_net.series[1].data;
      var send_k = "";
      var recv_k = "";
      var time = "";
      var old_time = "";
      for (var i = 0; i < v_vue.date.length; i++) {
        //option.xAxis[0].data.shift();
        //option.xAxis[0].data.push(axisData);
        time = v_vue.date[i];
        if (i != 0) {
          old_time = v_vue.date[i - 1];
          if (old_time > time) {
            console.log("net axis value error, time be passed!");
            continue;
          }
        }
        if (time != "") {
          var hours = (new Date(time)).getHours() < 10 ? "0" + (new Date(time)).getHours() : (new Date(time)).getHours();
          var minutes = (new Date(time)).getMinutes() < 10 ? "0" + (new Date(time)).getMinutes() : (new Date(time)).getMinutes();
          var seconds = (new Date(time)).getSeconds() < 10 ? "0" + (new Date(time)).getSeconds() : (new Date(time)).getSeconds();

          if (option_net.xAxis[0].data.length > 20)
            option_net.xAxis[0].data.shift();
          option_net.xAxis[0].data.push(hours + ":" + minutes + ":" + seconds);
        }

        send_k = convert_kb(v_vue.net_send[i]);
        recv_k = convert_kb(v_vue.net_recv[i]);
        if (data0.length > 20)
          data0.shift();
        data0.push(send_k);
        if (data1.length > 20)
          data1.shift();
        data1.push(recv_k);

        //set yaxis scale value
        option_net.yAxis[0].max = getTopNetworkIO(data0, data1);
        option_net.yAxis[0].axisLabel.formatter = "{value} k";

      }
      chart_net.setOption(option_net);
    }

    var updateInterval = 3000 //Fetch data ever x milliseconds
    var realtime = 'on' //If == to on then fetch data every x seconds. else stop fetching
    function update() {
      v_vue.refresh();
      draw_cpu();
      draw_mem();
      draw_net();

      clearTimeout(global_settimeout_id);
      if (realtime === 'on') {
        global_settimeout_id = setTimeout(update, updateInterval);
      }
      global_loading_ticks++;
      v_vue.loading_complete();
    }

    //REALTIME TOGGLE
    $('#realtime .btn').click(function() {
      if ($(this).data('toggle') === 'on') {
        realtime = 'on'
      } else {
        realtime = 'off'
      }
      update()
    })

    //input ip mask
    Vue.use(VueTheMask)


  </script>
</body>

</html>
