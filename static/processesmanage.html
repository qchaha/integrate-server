<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>devops rookie</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- Select2 -->
    <link rel="stylesheet" href="bower_components/select2/dist/css/select2.min.css">
    <!--v-tooltip-->
    <link rel="stylesheet" href="dist/css/v-tooltip.css">




    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
  page. However, you can choose any other skin. Make sure you
  apply the skin class to the body tag so the changes take effect. -->
    <link rel="stylesheet" href="dist/css/skins/skin-purple.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

    <!-- Google Font -->
    <link rel="stylesheet" href="dist/css/google-font.css">

    <!-- for flots label-->
    <style>
        .legendLabel {
            padding-right: 20px;
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: all 0.5s ease
        }

        .table-height {
            height: 480px;
        }

        /*hover table color*/

        .table-hover tbody tr:hover td,
        .table-hover tbody tr:hover th {
            background-color: #f0f7ff;
            cursor: pointer;
        }

        .table-selected {
            background-color: #f0f7ff;
        }

        .datatable-icon {
            font-size: 18px;
        }

        /*select2 css*/

        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            background-color: #3c8dbc;
            border-color: #367fa9;
            padding: 1px 10px;
            color: #fff;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
            margin-right: 5px;
            color: rgba(255, 255, 255, 0.7);
        }

        /*修复select2的placeholder显示不全bug*/

        .select2-selection--multiple .select2-search--inline .select2-search__field {
            width: auto !important;
        }

        /*select2的高度，宽度，可用来控制是否换行*/

        .select2-selection__rendered {
            height: 30px !important;
            width: 500px !important;
        }

        /* 新建流程对话框表单行距 */

        .form-group-newprocesses, .form-group-modifyprocesses {
            padding: 0 0 85px 0;
        }

        /* listgroup的行距 */

        .list-group-item {
            padding: 10px 0;
            text-align: center;
        }

        /* 选择list-group的背景颜色 */

        .well {
            background-color: #fbfbfb;
        }

        #vue_script_select_pool li:hover, #vue_script_selected li:hover {
            background-color: #f0f7ff;
            cursor: pointer;
        }

    </style>

    <style>
        [v-cloak] {
            display: none;
        }
    </style>

    <!--axios v0.17.1-->
    <script src="dist/js/axios.js"></script>

    <script>
        jwt = localStorage.getItem('jwt')
        var self = this;
        if (jwt) {
            axios.post('/api/isauth_v1.0', {
                visit_token: jwt
            })
                .then(function (response) {
                    if (response.data.rt_msg == "auth ok!") {
                        //console.log("auth ok!")
                    }
                    else {
                        location.href = 'login.html'
                    }
                })
                .catch(function (error) {
                    console.log(error)
                })
        }
        else {
            location.href = 'login.html'
        }
    </script>

</head>

<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->

<body class="hold-transition skin-purple sidebar-mini">

    <div class="wrapper">
        <!----------------------
    Main Header
    ------------------------>
        <script src="dist/module-js/main-header.js"></script>

        <!------------------------------------------
    Left side column. contains the logo and sidebar
            <script src="dist/module-js/main-sidebar.js"></script>
    -------------------------------------------->

        <aside class='main-sidebar'>
            <!-- sidebar: style can be found in sidebar.less -->
            <section class='sidebar'>
                <!-- Sidebar Menu -->
                <ul class='sidebar-menu' data-widget='tree'>
                    <li class='header'>主导航</li>
                    <!-- Optionally, you can add icons to the links -->
                    <li>
                        <a href='system-summary.html'>
                            <i class='fa fa-dashboard'></i>
                            <span>系统总体情况</span>
                        </a>
                    </li>
                    <li>
                        <a href='hosts.html'>
                            <i class='fa fa-desktop'></i>
                            <span>主机</span>
                        </a>
                    </li>
                    <li class='treeview'>
                        <a href='#'>
                            <i class='fa fa-database'></i>
                            <span>数据库</span>
                            <span class='pull-right-container'>
                                <i class='fa fa-angle-left pull-right'></i>
                            </span>
                        </a>
                        <ul class='treeview-menu'>
                            <li>
                                <a href='#'>
                                    <i class='fa fa-th' style='margin: 0 10px 0 0'></i>数据库管理</a>
                            </li>
                            <li>
                                <a href='#'>
                                    <i class='fa fa-copy' style='margin: 0 10px 0 0'></i>数据库备份管理</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href='#'>
                            <i class='fa fa-cubes'></i>
                            <span>虚拟化</span>
                        </a>
                    </li>
                    <li>
                        <a href='#'>
                            <i class='icon ion-android-phone-landscape' style='margin: 0 10px 0 0'></i>
                            <span>云终端</span>
                        </a>
                    </li>
                    <li class='treeview active'>
                        <a href='#'>
                            <i class='fa fa-wrench'></i>
                            <span>自动化管理</span>
                            <span class='pull-right-container'>
                                <i class='fa fa-angle-left pull-right'></i>
                            </span>
                        </a>
                        <ul class='treeview-menu'>
                            <li>
                                <a href='scriptmanage.html'>
                                    <i class='fa fa-file-code-o' style='margin: 0 10px 0 0'></i>脚本管理</a>
                            </li>
                            <li class="active">
                                <a href='processesmanage.html'>
                                    <i class='fa fa-object-group' style='margin: 0 10px 0 0'></i>流程管理</a>
                            </li>
                        </ul>
                    </li>
                    <li class='treeview'>
                        <a href='#'>
                            <i class='fa fa-gears' style='margin: 0 4px 0 0'></i>
                            <span>设置</span>
                            <span class='pull-right-container'>
                                <i class='fa fa-angle-left pull-right'></i>
                            </span>
                        </a>
                        <ul class='treeview-menu'>
                            <li>
                                <a href='#'>
                                    <i class='fa fa-user' style='margin: 0 10px 0 0'></i>用户管理</a>
                            </li>
                            <li>
                                <a href='#'>
                                    <i class='fa fa-cog' style='margin: 0 10px 0 0'></i>系统设置</a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <!-- /.sidebar-menu -->
            </section>
            <!-- /.sidebar -->
        </aside>

        <!------------------------------------------
    Content Wrapper. Contains page content
    -------------------------------------------->

        <div class="content-wrapper fade-enter-active fade-leave-active" style="height:900px" id="vueapp" v-cloak v-bind:style="{opacity: loading_status}">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>流程管理
                    <small>ProcessesManager</small>
                </h1>
            </section>
            <!--/. content-header-->
            <section class="content container-fluid">
                <!--hosts list-->
                <div class="col-md-5">
                    <div class="box box-primary" style="height:830px">
                        <div class="box-header with-border">
                            <h3 class="box-title"></h3>
                        </div>
                        <div class="mailbox-controls with-border">
                            <div class="btn-group" style="margin:20px">
                                <button type="button" class="btn btn-default bg-purple" data-toggle="modal" data-target="#modal-newprocesses">
                                    <i class="fa fa-plus"></i> 新建</button>
                            </div>
                            <div class="btn-group" style="margin:20px">
                                <button type="button" class="btn btn-default bg-maroon" data-toggle="modal" data-target="#modal-modifyprocesses">
                                    <i class="fa fa-pencil-square-o"></i> 修改</button>
                            </div>
                            <div class="btn-group" style="margin: 20px">
                                <button type="button" class="btn btn-default bg-red" data-toggle="modal" data-target="#modal-deletescript">
                                    <i class="fa fa-minus"></i> 删除</button>
                            </div>
                            <div class="btn-group" style="margin: 20px">
                                <button type="button" class="btn btn-default bg-gary"  v-on:click="open_multiselect()">{{ ismulti }}
                                    <i class="fa fa-tasks"></i>
                                </button>
                                <button type="button" class="btn btn-default dropdown-toggle bg-gary" data-toggle="dropdown" aria-expanded="false" v-if="ismulti != '多选'">
                                    <span class="caret"></span>
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li>
                                        <a href="#">全选</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a href="#">取消选择</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div style="height:660px">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th style="width: 10%; text-align: center">序号</th>
                                        <th style="width: 25%; text-align: center">流程名称</th>
                                        <th style="width: 47%; text-align: center">标签</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(row, index) in tablelines" v-on:click="show_selected_line_content(index + ( current_paging_number - 1 ) * paging_item_count, row.name)" v-bind:class="table_selected[index + ( current_paging_number - 1 ) * paging_item_count]"
                                    style="height: 50px;text-align: center">
                                    <td>
                                        <input type="checkbox" v-if="ismulti != '多选'" v-bind:value="index + ( current_paging_number - 1 ) * paging_item_count" v-model="checkbox_status">
                                        <label v-if="ismulti == '多选'">{{ index + ( current_paging_number - 1 ) * paging_item_count + 1 }}.</label>
                                    </td>
                                    <td>{{ row.name }}</td>
                                    <td style="text-align: left">
                                        <ul class="badge" style="margin: 0 15px 0 0" v-for="(tag,index) in tags[index + ( current_paging_number - 1 ) * paging_item_count]" v-bind:class="script_tag_color[tag]">{{ tag }}</ul>
                                    </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="box-footer clearfix" style="margin: -20px 0 0 0">
                                <ul class="pagination pagination-sm no-margin pull-right">
                                    <li><a href="javascript:void(0)" v-on:click="current_paging_number > 1? show_paging_data(current_paging_number - 1): ''">«</a></li>
                                    <li v-for="n in total_paging_count" v-bind:class="current_paging_number == n  ? 'active' : ''">
                                        <a href="javascript:void(0)" v-on:click="show_paging_data(n)">{{ n }}</a>
                                    </li>
                                    <li><a href="javascript:void(0)" v-on:click="current_paging_number < total_paging_count? show_paging_data(current_paging_number + 1): ''">»</a></li>
                                </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-7" >
                    <div class="box box-primary" style="height:830px; background-color: #f8f8f8; overflow:auto;">
                        <div class="box-header with-border" style="background-color: #fdfdfd">
                            <h3 class="box-title">流程一览</h3>
                        </div>
                        <div class="box-body fade-enter-active fade-leave-active" v-bind:style="{opacity: selected_line_detail_loading_status}">
                            <ul class="timeline">                          
                                <!-- timeline item -->
                                <li class="time-label">
                                    <span class="bg-yellow" style="width: 65px; text-align:center; letter-spacing:2px;">
                                     <i class="fa fa-hourglass-start"></i> 开始 
                                    </span>
                                    <div class="timeline-item">
                                            <h3 class="timeline-header">
                                                <a href="#">流程描述</a>
                                            </h3>
                                            <div class="timeline-body">
                                                {{ tablelines[checkbox_status[0]] != undefined ? tablelines[checkbox_status[0]].description : 'no' }}
                                            </div>
                                            <div class="timeline-footer">
                                                <a class="btn btn-primary btn-xs"></a>
                                            </div>
                                    </div>
                                </li>
                                <li v-for="(item, index) in selected_line_detail">
                                    <!-- timeline icon -->
                                    <i class="fa" v-bind:class="sequence_tag_color[(index + 1)%5]">{{ index + 1 }}</i>
                                    <div class="timeline-item">
                                        <h3 class="timeline-header">
                                            <a href="#">脚本名称：{{ item.s_name }}</a>
                                        </h3>
                                        <div class="timeline-body">
                                            脚本描述: {{ item.script_description }}
                                        </div>
                                        <div class="timeline-footer">
                                            <a class="btn btn-primary btn-xs"></a>
                                        </div>
                                    </div>
                                </li>
                                <!-- END timeline item -->
                                <!-- timeline item -->
                                <!-- END timeline item -->
                                <li class="time-label">
                                    <span class="bg-green" style="width: 65px; text-align:center; letter-spacing:2px;">
                                        <i class="fa fa-hourglass-end"></i> 结束 
                                    </span>
                                </li>
                                <!-- END timeline item -->
                            </ul>
                        </div>
                    </div>
                </div>
                <!--./hosts list-->
            </section>
            <!--./content container-fluid-->
        </div>
        <!--./wrapper-->

        <!-- 新建流程对话框 -->
        <div class="modal fade" id="modal-newprocesses">
            <div class="modal-dialog" style="width: 90%">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">
                            <i class=" headline fa fa-plus text-black" style="padding: 0 10px 0 0 "></i>新建流程</h4>
                    </div>
                    <div class="modal-body" style="height: 655px">
                        <div class="col-md-5">
                            <div class="box-header with-border">
                                <h3 class="box-title">
                                    <i class=" headline fa fa-pencil text-black" style="padding: 0 10px 0 0 "></i>新建流程信息</h3>
                            </div>
                            <!-- /.box-header -->
                            <!-- form start -->
                            <form class="form-horizontal">
                                <div class="box-body">
                                    <div class="form-group-newprocesses" id="div_script_name_newprocesses">
                                        <label class="col-sm-3 control-label">流程名称</label>
                                        <div class="input-group col-sm-6">
                                            <div class="input-group-addon">
                                                <i class="fa fa-newspaper-o" style="width: 12px"></i>
                                            </div>
                                            <input class="form-control" placeholder="流程名称不能包含中文" id="new_processes_name" style="width: 350px;" onblur="check_processes_name_isvalid()">
                                        </div>
                                        <span class="help-block" style="display:none;position:relative;left:25%;margin: 0 0 -20px 0" id="error_msg_exist_newprocesses">该流程名称已经存在，请重新输入！</span>
                                        <span class="help-block" style="display:none;position:relative;left:25%;margin: 0 0 -20px 0" id="error_msg_chinese_newprocesses">流程名称不能包含中文，请重新输入！</span>
                                        <!-- /.input group -->
                                    </div>
                                    <div class="form-group-newprocesses">
                                        <label class="col-sm-3 control-label">标签(可选)</label>
                                        <div class="input-group col-sm-7">
                                            <div class="input-group-addon">
                                                <i class="fa fa-tag" style="width: 12px"></i>
                                            </div>
                                            <select class="select2" multiple="multiple" id="select2_newprocesses">
                                            </select>
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                    <div class="form-group-newprocesses" id="div_newprocesses_description">
                                        <label class="col-sm-3 control-label">流程描述</label>
                                        <div class="input-group col-sm-4">
                                            <div class="input-group-addon">
                                                <i class="fa fa-list-ol" style="width: 12px"></i>
                                            </div>
                                            <textarea class="form-control" id="new_processes_description" onkeyup="textarea_words_deal()" style="height: 268px;width: 350px; resize: none;"
                                                placeholder="最多输入74个字符"></textarea>
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                </div>
                                <!-- /.box-body -->
                            </form>
                        </div>
                        <div class="col-md-7">
                            <div>
                                <div class="box-header with-border">
                                    <h3 class="box-title">
                                        <i class=" headline fa fa-map-o text-black" style="padding: 0 10px 0 0 "></i>流程编排
                                    </h3>
                                </div>
                                <div class="box-body fade-enter-active fade-leave-active col-md-5">
                                    <div class="form-group">
                                        <label>
                                            <h4>可选脚本</h4>
                                        </label>
                                        <div class="well" style="overflow: auto;height:465px;">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="input-group" style="padding: 0 0 10px 0">
                                                            <div class="input-group-addon">
                                                                <i class="glyphicon glyphicon-search" style="width: 12px"></i>
                                                            </div>
                                                            <input class="form-control" type="text" name="SearchDualList" class="form-control" placeholder="search" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="vue_script_select_pool">
                                                <ul class="list-group" v-for="(script, index) in scripts_info">
                                                    <li class="list-group-item" style="margin: 0 0 -21px 0" v-on:click="click_line(index)" v-bind:class="selected_line[index]">
                                                        <span v-tooltip="script.description">{{ script.name }}</span>
                                                        <span class="pull-right badge" v-bind:class="sequence_color[(sequence_array[index]%5)]" style="margin: 0 15px 0 -35px">{{ sequence_array[index] }}</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-body col-md-2" style="height: 465px;">
                                    <div class="btn-group-vertical" style="position: absolute;top: 50%;left: 50%;transform: translateX(-50%);">
                                        <button class="btn btn-default btn-sm" onclick="move_script_to_selected()">
                                            <span class="fa fa-chevron-right"></span>
                                        </button>
                                        <button class="btn btn-default btn-sm" style="margin: 50px 0 0 0;" onclick="move_script_to_select_pool()">
                                            <span class="fa fa-chevron-left"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="box-body fade-enter-active fade-leave-active col-md-5">
                                    <div class="form-group">
                                        <label>
                                            <h4>已选脚本</h4>
                                        </label>
                                        <div class="well" style="overflow: auto; height: 465px">
                                            <h5 style="color:red;font-weight:bold;padding: 0 0 15px 0;">请注意脚本顺序，流程按照编排顺序执行。</h5>
                                            <div id="vue_script_selected">
                                                <ul class="list-group" v-for="(selected_script, index) in selected_scripts_info">
                                                    <li class="list-group-item" style="margin: 0 0 -21px 0" v-on:click="click_line(index)" v-bind:class="selected_line[index]"> 
                                                        <span v-tooltip="selected_script.description">{{ selected_script.name }}</span>
                                                        <span class="pull-right badge" v-bind:class="sequence_color[(index+1)%5]" style="margin: 0 15px 0 -35px">{{ index + 1 }}</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal" id="add_processes_cancel_button" onclick="reset_all_variables()">
                            <i class="fa fa-close"></i> 取消</button>
                        <button type="button" id="button_new_processes_cant_submit" class="btn btn-danger disabled">
                            <i class="fa fa-check"></i> 确定</button>
                        <button type="button" id="button_new_processes_submit" style="display: none;" class="btn btn-danger" onclick="new_processes_submit()"
                            data-dismiss="modal">
                            <i class="fa fa-check"></i> 确定</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- 修改流程对话框 -->
        <div class="modal fade" id="modal-modifyprocesses">
            <div class="modal-dialog" style="width: 90%">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">
                            <i class=" headline fa fa-pencil-square-o text-black" style="padding: 0 10px 0 0 "></i>修改流程</h4>
                    </div>
                    <div class="modal-body" style="height: 655px">
                        <div class="col-md-5">
                            <div class="box-header with-border">
                                <h3 class="box-title">
                                    <i class=" headline fa fa-pencil text-black" style="padding: 0 10px 0 0 "></i>修改流程信息</h3>
                            </div>
                            <!-- /.box-header -->
                            <!-- form start -->
                            <form class="form-horizontal">
                                <div class="box-body">
                                    <div class="form-group-modifyprocesses" v-bind:class="class_div_process_name">
                                        <label class="col-sm-3 control-label">流程名称</label>
                                        <div class="input-group col-sm-6">
                                            <div class="input-group-addon">
                                                <i class="fa fa-newspaper-o" style="width: 12px"></i>
                                            </div>
                                            <input class="form-control" placeholder="流程名称不能包含中文" v-model="process_name" style="width: 350px;" v-on:blur="check_processes_name_isvalid()">
                                        </div>
                                        <span class="help-block" style="position:relative;left:25%;margin: 0 0 -20px 0" v-if="display_span_error_exist">该流程名称已经存在，请重新输入！</span>
                                        <span class="help-block" style="position:relative;left:25%;margin: 0 0 -20px 0" v-if="display_span_error_chinese">流程名称不能包含中文，请重新输入！</span>
                                        <!-- /.input group -->
                                    </div>
                                    <div class="form-group-modifyprocesses">
                                        <label class="col-sm-3 control-label">标签(可选)</label>
                                        <div class="input-group col-sm-7">
                                            <div class="input-group-addon">
                                                <i class="fa fa-tag" style="width: 12px"></i>
                                            </div>
                                            <select class="select2" multiple="multiple" onchange="vue_modify_processes.get_select2_value()" id="select2_modifyprocesses">
                                            </select>
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                    <div class="form-group-modifyprocesses" id="div_modofyprocesses_description">
                                        <label class="col-sm-3 control-label">流程描述</label>
                                        <div class="input-group col-sm-4">
                                            <div class="input-group-addon">
                                                <i class="fa fa-list-ol" style="width: 12px"></i>
                                            </div>
                                            <textarea class="form-control" v-model="process_description" id="new_processes_description" onkeyup="textarea_words_deal()" style="height: 268px;width: 350px; resize: none;"
                                                placeholder="最多输入74个字符"></textarea>
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                </div>
                                <!-- /.box-body -->
                            </form>
                        </div>
                        <div class="col-md-7">
                            <div>
                                <div class="box-header with-border">
                                    <h3 class="box-title">
                                        <i class=" headline fa fa-map-o text-black" style="padding: 0 10px 0 0 "></i>流程编排
                                    </h3>
                                </div>
                                <div class="box-body fade-enter-active fade-leave-active col-md-5">
                                    <div class="form-group">
                                        <label>
                                            <h4>可选脚本</h4>
                                        </label>
                                        <div class="well" style="overflow: auto;height:465px;">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="input-group" style="padding: 0 0 10px 0">
                                                            <div class="input-group-addon">
                                                                <i class="glyphicon glyphicon-search" style="width: 12px"></i>
                                                            </div>
                                                            <input class="form-control" type="text" name="SearchDualList" class="form-control" placeholder="search" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="vue_script_select_pool">
                                                <ul class="list-group" v-for="(script, index) in all_scripts">
                                                    <li class="list-group-item" style="margin: 0 0 -21px 0" v-on:click="click_line(index)" v-bind:class="selected_line[index]">
                                                        <span v-tooltip="script.description">{{ script.name }}</span>
                                                        <span class="pull-right badge" v-bind:class="sequence_color[(sequence_array[index]%5)]" style="margin: 0 15px 0 -35px">{{ sequence_array[index] }}</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-body col-md-2" style="height: 465px;">
                                    <div class="btn-group-vertical" style="position: absolute;top: 50%;left: 50%;transform: translateX(-50%);">
                                        <button class="btn btn-default btn-sm" onclick="move_script_to_selected()">
                                            <span class="fa fa-chevron-right"></span>
                                        </button>
                                        <button class="btn btn-default btn-sm" style="margin: 50px 0 0 0;" onclick="move_script_to_select_pool()">
                                            <span class="fa fa-chevron-left"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="box-body fade-enter-active fade-leave-active col-md-5">
                                    <div class="form-group">
                                        <label>
                                            <h4>已选脚本</h4>
                                        </label>
                                        <div class="well" style="overflow: auto; height: 465px">
                                            <h5 style="color:red;font-weight:bold;padding: 0 0 15px 0;">请注意脚本顺序，流程按照编排顺序执行。</h5>
                                            <div id="vue_script_selected">
                                                <ul class="list-group" v-for="(selected_script, index) in selected_scripts">
                                                    <li class="list-group-item" style="margin: 0 0 -21px 0" v-on:click="click_line(index)" v-bind:class="selected_line[index]"> 
                                                        <span v-tooltip="selected_script.description">{{ selected_script.name }}</span>
                                                        <span class="pull-right badge" v-bind:class="sequence_color[(index+1)%5]" style="margin: 0 15px 0 -35px">{{ index + 1 }}</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal" id="add_processes_cancel_button" onclick="reset_all_variables()">
                            <i class="fa fa-close"></i> 取消</button>
                        <button type="button" id="button_new_processes_cant_submit" class="btn btn-danger disabled">
                            <i class="fa fa-check"></i> 确定</button>
                        <button type="button" id="button_new_processes_submit" style="display: none;" class="btn btn-danger" onclick="new_processes_submit()"
                            data-dismiss="modal">
                            <i class="fa fa-check"></i> 确定</button>
                    </div>
                </div>
            </div>
        </div>


        <!----------------------
          Main Footer
          ------------------------>
        <script src="dist/js/vue.js"></script>
        <script src="dist/module-js/main-footer.js"></script>
    </div>
    <!--./wrapper-->

    <!-- Page script -->

    <!-- jQuery 3 -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap 3.3.7 -->
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- AdminLTE App slide navigator-->
    <script src="dist/js/adminlte.min.js"></script>
    <!-- Select2 -->
    <script src="bower_components/select2/dist/js/select2.full.min.js"></script>
    <!-- v-tooltip -->
    <script src="dist/js/v-tooltip.min.js"></script>


    <script>
        //新建流程对话框的确定
        function new_processes_submit()
        {
            //获取select2被选中的值
            var select_content = $("#select2_newprocesses").select2("data");
            var processes_tags = ''
            if (select_content.length) {
                for (var i = 0; i < select_content.length; i++) {
                    if (processes_tags == '') {
                        processes_tags = select_content[i].text;
                    }
                    else {
                        processes_tags = processes_tags + "#" + select_content[i].text;
                    }
                }
            }

            //获取新建表单内容
            var new_processes_name = document.getElementById("new_processes_name").value;
            var new_processes_description = document.getElementById("new_processes_description").value;

            axios.post('/api/add_processes_v1.0', {
                processes_name: new_processes_name,
                processes_description: new_processes_description,
                processes_tag: processes_tags,
                selected_scripts: vue_script_selected.selected_scripts_info,
                visit_token: jwt
            })
                .then(function (response) {
                    //console.log(response.data);
                    if (response.data.add_processes_result == "add_processes_successful") 
                    {
                        vue.fetch_table_lines(vue.tablelines.length, 0);
                        reset_all_variables();
                        document.getElementById("add_processes_cancel_button").click();
                        //window.location.reload();
                    }
                    else 
                    {
                        alert("add processes error!")
                    }
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        //限制textarea字数，74个
        function textarea_words_deal() 
        {
            var new_processes_curLength = $("#new_processes_description").val().length;
            var div_newprocesses_description = document.getElementById("div_newprocesses_description");

            if (new_processes_curLength > 74) 
            {
                var num = $("#new_processes_description").val().substr(0, 74);
                $("#new_processes_description").val(num);
                div_newprocesses_description.className = "form-group-newprocesses has-error";
                setTimeout(function () { div_newprocesses_description.className = "form-group-newprocesses" }, 500);
            }
            isreadytosubmit();
        }


        //检查是否符合对话框submit条件
        function isreadytosubmit()
        {
            //新建流程对话框
            var new_processes_name = document.getElementById("new_processes_name");
            var div_script_name_newprocesses = document.getElementById("div_script_name_newprocesses");
            var error_msg_exist_newprocesses = document.getElementById("error_msg_exist_newprocesses");
            var error_msg_chinese_newprocesses = document.getElementById("error_msg_chinese_newprocesses");
            var new_processes_description = document.getElementById("new_processes_description");

       
            if (new_processes_name.value != "" && new_processes_description.value != "" && div_script_name_newprocesses.className != "form-group-newprocesses has-error" && vue_script_selected.selected_scripts_info.length > 0) 
            {
                document.getElementById("button_new_processes_cant_submit").style.display = 'none';
                document.getElementById("button_new_processes_submit").style.display = '';
            }
            else 
            {
                document.getElementById("button_new_processes_cant_submit").style.display = '';
                document.getElementById("button_new_processes_submit").style.display = 'none';
            }
        }

        //检查新建的流程名是否有效
        function check_processes_name_isvalid()
        {
            var new_processes_name = document.getElementById("new_processes_name");

            var div_script_name_newprocesses = document.getElementById("div_script_name_newprocesses");

            var error_msg_exist_newprocesses = document.getElementById("error_msg_exist_newprocesses");
            var error_msg_chinese_newprocesses = document.getElementById("error_msg_chinese_newprocesses");

            var check_name = "";

            if (new_processes_name.value != "") {
                check_name = new_processes_name.value.replace(/^\s+|\s+$/g, "");
            }
            else {
                console.log("new_processes_name is not input!")
            }
            //先检查流程名是否包含中文
            if (/.*[\u4e00-\u9fa5]+.*$/.test(check_name)) {
                div_script_name_newprocesses.className = "form-group-newprocesses has-error";
                error_msg_exist_newprocesses.style.display = "none";
                error_msg_chinese_newprocesses.style.display = "";
            }
            //再检查流程名是否已经存在
            else {
                jwt = localStorage.getItem('jwt');
                axios.post('/api/fetch_processes_content_v1.0', {
                    processes_name: check_name,
                    visit_token: jwt
                })
                .then(function (response) {
                    if (response.data.processes_content == "can not fetch any processes!") 
                    {
                        div_script_name_newprocesses.className = "form-group-newprocesses";
                        error_msg_exist_newprocesses.style.display = "none";
                        error_msg_chinese_newprocesses.style.display = "none";
                    }
                    else if(response.data.processes_content == "fetch processes content from mysql error")
                    {
                        console.log("query database error")
                    }
                    else 
                    { 
                        console.log("already exist!");
                        div_script_name_newprocesses.className = "form-group-newprocesses has-error";
                        error_msg_exist_newprocesses.style.display = "";
                        error_msg_chinese_newprocesses.style.display = "none";
                    }
                })
                .catch(function (error) {
                    console.log(error)
                })
            }
            //由于上面有axios的后台查询，建议使用settimeout来调用check，万一axios返回值比较慢时，可能会出现先检查了值才赋好的情况，正常是先赋值再检查
            setTimeout(function(){isreadytosubmit()}, 300);
        }
        
        //对话框的取消和关闭按钮
        function reset_all_variables()
        {
            var new_processes_name = document.getElementById("new_processes_name");
            var div_script_name_newprocesses = document.getElementById("div_script_name_newprocesses");
            var error_msg_exist_newprocesses = document.getElementById("error_msg_exist_newprocesses");
            var error_msg_chinese_newprocesses = document.getElementById("error_msg_chinese_newprocesses");

            var div_newprocesses_description = document.getElementById("div_newprocesses_description");
            var new_processes_description = document.getElementById("new_processes_description");

            new_processes_name.value = "";
            div_script_name_newprocesses = "form-group-newprocesses";
            error_msg_exist_newprocesses.style.display = "none";
            error_msg_chinese_newprocesses.style.display = "none";
            div_newprocesses_description = "form-group-newprocesses";
            new_processes_description.value = "";

            $('.select2').val(null).trigger('change');

            document.getElementById("button_new_processes_cant_submit").style.display = '';
            document.getElementById("button_new_processes_submit").style.display = 'none';

            vue_script_select_pool.reset_all_data();
            vue_script_selected.reset_all_data();
        }

        //实现搜索控件的功能
        $('[name="SearchDualList"]').keyup(function (e) {
            var code = e.keyCode || e.which;
            if (code == '9') return;
            if (code == '27') $(this).val(null);
            var $rows = $(this).closest('.well').find('.list-group li');
            var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
            $rows.show().filter(function () {
                var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
                return !~text.indexOf(val);
            }).hide();
        });

        //显示tooltip
        $('a').tooltip();

        //获取script tags的值放到select2控件
        function get_tags_to_select2() {
            jwt = localStorage.getItem('jwt')

            axios.post('/api/fetch_all_script_tags_v1.0', {
                visit_token: jwt
            })
                .then(function (response) {
                    //console.log(response.data.script_tags);
                    var data = response.data.script_tags;
                    $('.select2').select2(
                        {
                            //dropdownAutoWidth: true,
                            maximumSelectionLength: 3,
                            language: "zh-CN",
                            width: 350,
                            placeholder: "至多选择三个标签",
                            data: data
                        });
                    //设置脚本标签颜色
                    for (var i = 0; i < data.length; i++) {
                        if (i % 5 == 0) {
                            vue.script_tag_color[data[i].text] = "bg-blue";
                        }
                        else if (i % 5 == 1) {
                            vue.script_tag_color[data[i].text] = "bg-aqua";
                        }
                        else if (i % 5 == 2) {
                            vue.script_tag_color[data[i].text] = "bg-green";
                        }
                        else if (i % 5 == 3) {
                            vue.script_tag_color[data[i].text] = "bg-yellow";
                        }
                        else if (i % 5 == 4) {
                            vue.script_tag_color[data[i].text] = "bg-red";
                        }
                    }
                    //console.log(vue.script_tag_color)
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        function move_script_to_select_pool()
        {
            var select_item_count = 0;
            var delete_item_count = 0;

            for( var i = 0; i < vue_script_selected.selected_line.length; i++)
            {
                if( vue_script_selected.selected_line[i] == "table-selected" )
                {
                    Vue.set(vue_script_select_pool.scripts_info, vue_script_select_pool.scripts_info.length, vue_script_selected.selected_scripts_info[i]);
                }
            }

            for( var i = 0; i < vue_script_selected.selected_line.length; i++ )
            {
                if( vue_script_selected.selected_line[i] == "table-selected" )
                {
                    Vue.delete(vue_script_selected.selected_scripts_info, i - delete_item_count++ );
                    select_item_count++;
                }
            }

            vue_script_select_pool.sequence_cursor = vue_script_select_pool.sequence_cursor - select_item_count;
            vue_script_selected.selected_line = [];

            isreadytosubmit();
        }

        //把选中的可选脚本放到已选脚本中
        function move_script_to_selected()
        {
            //获取一次选中了多少个可选脚本
            for( var x = 0; x < vue_script_select_pool.selected_line.length; x++ )
            {
                //搜索哪些行有序号badge标记
                for( var i = 0; i < vue_script_select_pool.sequence_array.length; i++ )
                {
                    //获取第几行被选中，当值为数字则说明这行有序号badge
                    if( !isNaN(vue_script_select_pool.sequence_array[i]) && vue_script_select_pool.sequence_array[i] != null && vue_script_select_pool.sequence_array[i] != "" )
                    {
                        //顺接上一次选中的行，实现序号顺接，这个判断能区分序号大小，当且仅当 可选脚本的行序号 等于 已选脚本的行数+1 时，才说明是顺接关系
                        if( vue_script_select_pool.sequence_array[i] == vue_script_selected.selected_scripts_info.length + 1 )
                        {
                            //找到顺接的行放到已选脚本中
                            Vue.set(vue_script_selected.selected_scripts_info, vue_script_selected.selected_scripts_info.length, vue_script_select_pool.scripts_info[i]);
                        }
                    }
                }
            }
            //由于vue.delete会改变数组的长度，所以每次delete后我们也要改变删除的位置
            var delete_item_count = 0;
            //获取选中了哪些可选脚本
            for( var i = 0; i < vue_script_select_pool.selected_line.length; i++ )
            {
                //获取选中行
                if( vue_script_select_pool.selected_line[i] == "table-selected" )
                {   
                    //由于vue.delete会改变数组的长度，所以每一次删除后，delete_item_count需要加1，确保for循环中的删除位置正确
                    Vue.delete(vue_script_select_pool.scripts_info, i - delete_item_count++);
                }       
            }
            //清空选中状态
            vue_script_select_pool.sequence_array = [];
            vue_script_select_pool.selected_line = [];

            isreadytosubmit();
        }

        var vue = new Vue({
            el: '#vueapp',
            data: {
                tablelines: [],                             //保存所有需要展示的数据行
                selected_line_detail: [],                   //展示选定的具体数据
                loading_status: 0,                          //页面loading
                selected_line_detail_loading_status: 0,     //展示选定的具体数据loading
                table_selected: [],                         //标识被选中的行样式
                checkbox_status: [],                        //记录每一行checkbox是否选中
                single_select_row_temp: '',                 //记录进入多选前，哪一行被选中
                ismulti: '多选',                            //标识是否为多选状态
                selected_line_description: '',              //保存选定行的描述内容
                total_paging_count: 0,                      //一个多少个分页
                paging_tablelines: [],                      //显示当前的分页项目
                paging_item_count: 12,                      //每页显示多少条数据
                current_paging_number: 1,                   //记录当前哪个分页被选中
                tags: [],                                   //保存流程的tag信息
                script_tag_color: [],                       //保存脚本标签颜色，不同脚本标签代表不同的颜色
                sequence_tag_color: ['bg-blue', 'bg-aqua', 'bg-green', 'bg-yellow', 'bg-red'],    //记录脚本顺序的颜色
            },
            mounted: function(){
                var self = this;
                setTimeout(function(){self.loading_status = 1}, 500);
                self.fetch_table_lines(0, 1);
                get_tags_to_select2();
            },
            methods: {
                fetch_table_lines: function (selected_line, page_number) {
                    var self = this;
                    jwt = localStorage.getItem('jwt');
                    self.tablelines = [];
                    axios.post('/api/fetch_all_processes_v1.0',{
                        visit_token: jwt
                    })
                        .then(function (response) {
                            //console.log(response.data.script)
                            for (var i = 0; i < response.data.fetch_all_processes_result.length; i++) {
                                Vue.set(self.tablelines, i, response.data.fetch_all_processes_result[i]);
                                self.tags[i] = self.tablelines[i].tag.split("#");
                            }

                            //设置第几行被选中，显示第几个脚本内容，显示第几分页
                            self.set_selected_status(selected_line);
                            self.show_selected_line_content(selected_line, self.tablelines[selected_line].name);

                            //新建脚本、导入脚本、修改脚本
                            if( page_number == 0 )
                            {
                                self.current_paging_number = Math.ceil(self.tablelines.length / self.paging_item_count);
                            }
                            //删除脚本、第一次读入页面
                            else
                            {
                                self.current_paging_number = page_number;
                            }

                            //初始化分页标签
                            self.show_paging_data(self.current_paging_number);
                        })
                        .catch(function (error) {
                            console.log(error)
                        })
                },
                show_paging_data: function(n){
                    var self = this;
                    var is_first_load = self.paging_tablelines.length;

                    //多少个分页=数据总条数/每页显示数
                    self.total_paging_count = Math.ceil(self.tablelines.length / self.paging_item_count);

                    //获取当前哪个分页被选中
                    self.current_paging_number = n;

                    self.paging_tablelines = [];

                    for( var i = 0; i < self.paging_item_count; i++ )
                    {
                        if( (self.current_paging_number - 1) * self.paging_item_count + i < self.tablelines.length )
                        {
                            self.paging_tablelines.push( self.tablelines[ (self.current_paging_number - 1) * self.paging_item_count + i ] );
                            //console.log((self.current_paging_number - 1) * self.paging_item_count + i)
                        }
                    }
                },
                open_multiselect: function () {
                    var self = this;
                    if (self.ismulti == '单选') {
                        self.ismulti = '多选';
                        //切换回单选时，恢复进入多选前的状态
                        self.checkbox_status = [];
                        self.checkbox_status.push(self.single_select_row_temp);
                        self.table_selected = [];
                        Vue.set(self.table_selected, self.single_select_row_temp, "table-selected");
                    }
                    else if (self.ismulti == '多选') {
                        self.ismulti = '单选';
                        self.single_select_row_temp = self.checkbox_status[0];
                    }
                },
                set_selected_status: function (index) {
                    var self = this;
                    if (self.ismulti == '多选') {
                        for (var i = 0; i < self.tablelines.length; i++) {
                            Vue.set(self.table_selected, i, '')
                        }
                        Vue.set(self.table_selected, index, "table-selected");
                        //重置checkbox状态，只记录选中的行
                        self.checkbox_status = [];
                        self.checkbox_status.push(index);
                    }
                    else if (self.ismulti == '单选') {
                        if (self.table_selected[index] == "table-selected") {
                            Vue.set(self.table_selected, index, "");
                            for (var i = 0; i < self.checkbox_status.length; i++) {
                                //处理checkbox状态，原来是被选中的状态，要改为未选中
                                if (self.checkbox_status[i] == index) {
                                    self.checkbox_status.splice(i, 1);
                                }
                            }
                        }
                        else if (self.table_selected[index] == "") {
                            Vue.set(self.table_selected, index, "table-selected");
                            self.checkbox_status.push(index);
                        }
                    }
                },
                show_selected_line_content: function (index, processes_name) {
                    var self = this;
                    if (self.ismulti == '单选') {
                        self.set_selected_status(index);
                    }
                    else if (self.ismulti == '多选') {
                        jwt = localStorage.getItem('jwt');

                        //过渡显示效果
                        self.selected_line_detail_loading_status = 0;
                        setTimeout(function () { self.selected_line_detail_loading_status = 1 }, 300);

                        axios.post('/api/fetch_processes_content_v1.0', {
                            processes_name: processes_name,
                            visit_token: jwt
                        })
                        .then(function (response) {
                            setTimeout(function(){
                                self.selected_line_detail = response.data.processes_content;
                                self.set_selected_status(index);
                            },300);
                            //console.log(response.data.processes_content)
                        })
                        .catch(function (error) {
                            console.log(error)
                        });
                    }
                },
            },
        });


        var vue_script_select_pool = new Vue({
            el: '#vue_script_select_pool',
            data: {
                scripts_info: [],                                                       //可选脚本
                selected_line: [],                                                      //保存哪些行被选中
                sequence_cursor: 1,                                                     //保存顺序，自增
                sequence_array: [],                                                     //保存每行的顺序
                sequence_color: ["bg-blue","bg-aqua","bg-green","bg-yellow","bg-red"],  //badgede yanse 
            },
            mounted: function(){
                var self = this;
                self.fetch_all_script_info();
            },
            methods: {
                //点击可选脚本中的行
                click_line: function(index){
                    var self = this;
                    //获取选中行的序号
                    select_num_is = self.sequence_array[index];
                    //如果点击的行还没被选过
                    if( self.selected_line[index] != "table-selected" )
                    {
                        Vue.set(self.selected_line, index, "table-selected");
                        Vue.set(self.sequence_array, index, self.sequence_cursor);
                        //选中行时序号加1
                        self.sequence_cursor = self.sequence_cursor + 1;
                    }
                    //如果点击的行已经被选中
                    else
                    {
                        //取消被选中的状态
                        Vue.set(self.selected_line, index, "");
                        for( var i = 0; i < self.scripts_info.length; i++ )
                        {
                            //先判断数组值为数字
                            if( !isNaN(self.sequence_array[i]) && self.sequence_array[i] != null && self.sequence_array[i] != "" )
                            {
                                //取消被选中行的序号badge
                                if( i == index )
                                {
                                    Vue.set(self.sequence_array, i, "");
                                }
                                else
                                {
                                    //其余序号中，比选中行的序号大的，要减一，比选中行小的，保持原值
                                    if( self.sequence_array[i] > select_num_is )
                                    {   //console.log(self.sequence_array[i] + "is > " + select_num_is);
                                        self.sequence_array[i] = self.sequence_array[i] - 1;
                                    }
                                }
                            }
                        }
                        //取消选中时序号减1
                        self.sequence_cursor = self.sequence_cursor - 1;                     
                    }
                },
                fetch_all_script_info: function () {
                    jwt = localStorage.getItem('jwt')

                    var self = this;
                    self.scripts_info = [];
                    axios.post('/api/fetch_all_scripts_v1.0',{
                        visit_token: jwt 
                    })
                    .then(function (response) {
                        //console.log(response.data.script)
                        for (var i = 0; i < response.data.script.length; i++) {
                            Vue.set(self.scripts_info, i, response.data.script[i]);
                            //self.tags[i] = self.scripts_info[i].tag.split("#");
                        }
                    })
                    .catch(function (error) {
                        console.log(error)
                    })
                },
                reset_all_data: function(){
                    var self = this;
                    self.scripts_info = [];
                    self.selected_line = [];  
                    self.sequence_cursor = 1; 
                    self.sequence_array = [];
                    self.fetch_all_script_info();
                },
            },
        });


        var vue_script_selected = new Vue({
            el: '#vue_script_selected',
            data: {
                selected_scripts_info: [],                                               //已选脚本
                selected_line: [],                                                       //保存哪些行被选中
                sequence_color: ["bg-blue","bg-aqua","bg-green","bg-yellow","bg-red"],   //顺序badge的颜色
            },
            mounted: function(){
                var self = this;
            },
            methods: {
                click_line: function(index){
                    var self = this;
                    if( self.selected_line[index] != "table-selected" )
                    {
                        Vue.set(self.selected_line, index, "table-selected");
                    }
                    else
                    {
                        Vue.set(self.selected_line, index, "");
                    }
                },
                reset_all_data: function(){
                    var self = this;
                    self.selected_scripts_info = [];
                    self.selected_line = [];
                },
            },
        });


        var vue_modify_processes = new Vue({
            el: '#modal-modifyprocesses',
            data: {
                process_name: '',
                process_tags: [],
                process_description: '',

                class_div_process_name: 'form-group-newprocesses',
                display_span_error_exist: false,
                display_span_error_chinese: false,

                all_scripts: [],                                                         //所有脚本
                selected_scripts: [],                                                    //已选脚本
                selected_line: [],                                                       //保存哪些行被选中
                sequence_color: ["bg-blue","bg-aqua","bg-green","bg-yellow","bg-red"],   //顺序badge的颜色
            },
            mounted: function(){
                var self = this;
            },
            methods: {
                get_select2_value: function(){
                    var self = this;
                    //获取select2被选中的值
                    self.process_tags = $("#select2_modifyprocesses").select2("data");
                },
                check_processes_name_isvalid: function(){
                    var self = this;
                    //先检查流程名是否包含中文
                    if (/.*[\u4e00-\u9fa5]+.*$/.test(self.process_name)) {
                        self.class_div_process_name = "form-group-newprocesses has-error";
                        self.display_span_error_chinese = true;
                        self.display_span_error_exist= false;
                    }
                    //再检查流程名是否已经存在
                    else {
                        jwt = localStorage.getItem('jwt');
                        axios.post('/api/fetch_processes_content_v1.0', {
                            processes_name: self.process_name,
                            visit_token: jwt
                        })
                        .then(function (response) {
                            if (response.data.processes_content == "can not fetch any processes!") 
                            {
                                self.class_div_process_name = "form-group-newprocesses";
                                self.display_span_error_chinese = false;
                                self.display_span_error_exist= false;
                            }
                            else if(response.data.processes_content == "fetch processes content from mysql error")
                            {
                                console.log("query database error")
                            }
                            else 
                            { 
                                //console.log("already exist!");
                                self.class_div_process_name = "form-group-newprocesses has-error";
                                self.display_span_error_chinese = false;
                                self.display_span_error_exist= true;
                            }
                        })
                        .catch(function (error) {
                            console.log(error)
                        })
                    }
                },
                click_line: function(index){
                    var self = this;
                    if( self.selected_line[index] != "table-selected" )
                    {
                        Vue.set(self.selected_line, index, "table-selected");
                    }
                    else
                    {
                        Vue.set(self.selected_line, index, "");
                    }
                },
                reset_all_data: function(){
                    var self = this;
                    self.selected_scripts_info = [];
                    self.selected_line = [];
                },
            },
        });

    </script>
</body>

</html>